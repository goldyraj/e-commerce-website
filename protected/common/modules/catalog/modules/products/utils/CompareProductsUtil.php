<?php/** * @copyright Copyright (C) 2016 Usha Singhai Neo Informatique Pvt. Ltd * @license https://www.gnu.org/licenses/gpl.html */namespace products\utils;use usni\UsniAdaptor;use customer\utils\CustomerUtil;use products\models\Product;use products\utils\ProductUtil;use kartik\rating\StarRating;use common\utils\ApplicationUtil;/** * CompareProductsUtil class file. *  * @package products\utils */class CompareProductsUtil{    /**     * Add to compare productst script     * @return string     */    public static function addToCompareProductsScript()    {        $url = UsniAdaptor::createUrl('/catalog/products/site/add-to-compare');        $js = "$('body').on('click', '.product-compare, .add-product-compare', function(){                    var selectedVal = $(this).data('productid');                    $.ajax({                            url: '{$url}',                            type: 'post',                            data: 'productId=' + selectedVal,                            dataType: 'json',                            success: function(json) {                                if (json['success']) {                                    $('.success').fadeIn('slow');                                    $('.top-nav-compareproduct').html(json['data']);                                    $('html, body').animate({ scrollTop: 0 }, 'slow');                                 }	                            }                        });               })";        return $js;    }        /**     * Renders compare products in top navigation.     * @return string     */    public static function renderCompareProductsInTopnav()    {        $compareProducts   = ApplicationUtil::getCompareProducts();        $count             = $compareProducts->getCount();        $content           = UsniAdaptor::t('products', 'Compare');        if($count > 0)        {            return $content . ' (' . $count . ')';        }        return $content;    }        /**     * Populate customer metadata in session     * @return void     */    public static function populateCustomerMetadataInSession()    {        $itemsList          = CustomerUtil::getMetadataItems('compareproducts');        $compareproducts    = UsniAdaptor::app()->customer->compareproducts;        $compareproducts->itemsList  = $itemsList;        UsniAdaptor::app()->customer->updateSession('compareproducts', $compareproducts);    }        /**     * Get products.     * @return array     */    public static function getProducts()    {        $products           = [];        $compareProducts    = ApplicationUtil::getCompareProducts();        if($compareProducts->itemsList != null)        {            $products = Product::find()->where(['id' => $compareProducts->itemsList])->all();        }        return $products;    }        /**     * Get product rating.     * @param int $id     * @return string     */    public static function getProductRating($id)    {        $overallRating   = ProductUtil::getOverallRating($id);        return StarRating::widget([        'name' => 'rating_' . $id,        'value' => $overallRating,        'pluginOptions' => [            'readonly' => true,            'showClear' => false,            'showCaption' => false,            'size' => 'sm'        ],    ]);    }        /**     * Get Product Image.     * @param int $id     */    public static function getProductImage($id)    {        return null;    }        /**     * Remove from compare products list script     * @return string     */    public static function removeFromCompareProductScript()    {        $url = UsniAdaptor::createUrl('catalog/products/site/remove');        $js = "$('body').on('click', '.productcompare-remove', function(){                    var selectedVal = $(this).data('productid');                    $.ajax({                            url: '{$url}',                            type: 'get',                            data: 'product_id=' + selectedVal,                            dataType: 'json',                            success: function(json) {                                if (json['success']) {                                    $('.success').fadeIn('slow');                                    $('.top-nav-compareproduct').html(json['headerCompareProductListContent']);                                    $.pjax.reload({container:'#compareproductslistview-pjax', 'timeout':2000});                                }	                            }                        });               })";        return $js;    }}